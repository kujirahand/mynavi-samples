# PHPでWebメモ帳を作成するためのコーディング規約

## プロジェクト概要
シンプルで安全なWebメモ帳をPHPで作成します。格安レンタルサーバー（月300円程度）で動作することを前提とします。

## 技術仕様
- **言語**: PHP 7.4以上
- **データベース**: SQLite（ファイルベース）
- **認証**: シンプルなパスワード認証
  - ユーザー名: my-notepad
  - パスワード: Tg0s4lmO9m1o1N8M)
- **フロントエンド**: HTML/CSS

## ファイル構成

```
/
├── index.php          # メインページ（メモ一覧・作成・編集）
├── config.php         # 設定ファイル
├── database.php       # データベース操作
├── style.css          # スタイルシート
├── data/
│   ├── .htaccess      # Apache設定ファイル(アクセス制限用)
│   ├── schema.sql     # デーベースのスキーマ定義ファイル
│   └── notes.db       # SQLiteデータベースファイル
├── image/
│   ├── 0001.jpg       # 添付画像0001.jpg
│   └── 0002.jpg       # 添付画像0002.jpg
└── .htaccess          # Apache設定ファイル
```

## コーディング規約

### PHP全般
- **文字エンコーディング**: UTF-8
- **改行コード**: LF（Unix形式）
- **インデント**: スペース4文字
- **PHPタグ**: 完全形式（`<?php`）を使用、短縮形（`<?`）は禁止
- **変数名**: スネークケース（例: `$user_name`）
- **関数名**: スネークケース（例: `get_user_notes()`）
- **定数名**: アッパースネークケース（例: `DB_PATH`）

### セキュリティ対策
- **SQLインジェクション対策**: PDOのプリペアドステートメント必須
- **XSS対策**: 出力時に`htmlspecialchars()`を必須で使用
- **CSRF対策**: フォームにCSRFトークンを実装
- **ファイルアクセス制限**: `.htaccess`で`data/`ディレクトリへの直接アクセスを禁止

### データベース設計

次のようなテーブルを作成してください。

- notes テーブル
  - カラム: id, title, content, created_at, updated_at
- images テーブル
  - カラム: id, filename, uploaded_at

## 機能要件
1. **メモ作成**: タイトルと本文を入力してメモを作成
2. **メモ一覧**: 作成したメモの一覧表示
3. **メモ編集**: 既存メモの編集機能
4. **メモ削除**: メモの削除機能（確認ダイアログ付き）
5. **検索機能**: タイトルと本文での検索
6. **並び替え**: 作成日時、更新日時での並び替え
7. **画像添付**: メモに画像を添付できる機能。画像一覧ページで添付画像を表示

## 非機能要件
- **セキュリティ**: 基本的なWebセキュリティ対策を実装
- **パフォーマンス**: 格安サーバーでも快適に動作
- **保守性**: シンプルで理解しやすいコード
- **移植性**: 一般的なPHP環境で動作

## 制約事項
- 複数ユーザー対応は不要（単一ユーザー想定）
- 高度なUIライブラリは使用しない
- 外部APIとの連携は不要
- ファイルアップロード機能は不要

## 開発方針
1. **最小限の機能から開始**: まずは基本的なCRUD機能を実装
2. **セキュリティ優先**: 基本的なセキュリティ対策を必ず実装
3. **シンプル設計**: 複雑な設計パターンは避ける
4. **テスト可能**: 手動テストが容易な構造にする

## メモ帳の本文
- メモの本文はMarkdown形式で保存するものとするが『#』とリンクと画像のみ簡単な正規表現置換でHTMLに変換して表示する

## 画像ファイルの添付について
- 画像ファイルは`image/`ディレクトリに保存
- 画像ファイル名は連番（例: `0001.jpg`, `0002.jpg`）で管理
- 簡単な画像のアップロード機能を実装
- メモ本文に画像を添付できるようにする(例: `![画像](image/0001.jpg)`)
- 書式『![画像](image/0001.jpg)』があれば、それを<img>タグに変換して表示する
