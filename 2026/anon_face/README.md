# 顔匿名化CLIツール

人物の顔にパンダやウサギのマスクを被せて匿名化するCLIツールです。撮影時の楽しい雰囲気をそのままに、顔バレを防ぐことができます。

## 機能

- OpenCVによる自動顔検出
- OpenAI DALL-E 2 APIを使用した自然なマスク生成
- パンダまたはウサギのマスクをランダムに選択
- コマンドラインから簡単に実行可能

## セットアップ

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. OpenAI APIキーの設定

OpenAI APIキーを取得して環境変数に設定します。

1. [OpenAI Platform](https://platform.openai.com/api-keys)でAPIキーを取得
2. `.env`ファイルを作成（`.env.example`をコピー）
3. APIキーを設定

```bash
cp .env.example .env
# .env ファイルを編集して OPENAI_API_KEY を設定
```

または、環境変数として直接設定:

```bash
export OPENAI_API_KEY="your-api-key-here"
```

## 使い方

### 基本的な使い方

```bash
python anon_face.py 画像ファイル.jpg
```

出力ファイルは以下のように保存されます：
- `画像ファイル-anon.png` - 匿名化された画像
- `画像ファイル-mask.png` - 使用されたマスク画像

### 出力ファイル名を指定する場合

```bash
python anon_face.py 画像ファイル.jpg -o 出力ファイル.png
```

### 実行例

```bash
# 写真を匿名化
python anon_face.py party_photo.jpg

# 出力:
# - party_photo-anon.png (匿名化された画像)
# - party_photo-mask.png (マスク画像)
```

## 処理の流れ

1. 画像ファイルを読み込み
2. OpenCVで顔を自動検出
3. 検出された顔領域にマスク画像を生成
4. DALL-E 2 APIでパンダまたはウサギのマスクを描画
5. 匿名化された画像を保存

## 注意事項

- DALL-E 2 APIの使用には料金が発生します
- 画像サイズは1024x1024にリサイズされます
- 顔が検出されない場合はエラーになります
- インターネット接続が必要です

## トラブルシューティング

### 顔が検出されない場合

- 顔が正面を向いているか確認してください
- 画像が明るく、顔がはっきり写っているか確認してください
- 顔のサイズが小さすぎないか確認してください

### APIキーのエラー

```
OpenAI APIキーが設定されていません
```

環境変数 `OPENAI_API_KEY` が正しく設定されているか確認してください。

### 画像が読み込めない

```
画像を読み込めませんでした
```

- ファイルパスが正しいか確認してください
- 画像ファイルが破損していないか確認してください
- サポートされている画像形式（JPG、PNG等）か確認してください

## ライセンス

このツールは個人利用・商用利用ともに自由に使用できます。
